<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="/static/styles/colors.css" />
  <link rel="stylesheet" href="/static/styles/global.css" />
  <link rel="stylesheet" href="/static/styles/code.css" />


  <link rel="icon" href="/static/icon/icon.svg" type="image/svg+xml">
  <link rel="shortcut icon" href="/static/icon/favicon.ico" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
  <title>notes: alculator</title>
</head>

<body>
  <nav>
    <div class="main-icon">
      <a href="/">
        <svg xmlns="http://www.w3.org/2000/svg" baseProfile="full" version="1.1" style="fill: none;"
          viewBox="26.88 56.87 216.25 156.27">
          <path
            style="stroke-width: 15px; stroke-linecap: butt; stroke-linejoin: round; stroke: rgb(10, 10, 10); fill: none;"
            d="M135,75 A60,60 0 0,0 75,135 A60,60 0 0,0 135,195 A60,60 0 0,0 195,135 A60,60 0 0,0 135,75 M45,90 A15,15 0 0,1 60,75 A15,15 0 0,1 75,90 L75,135 L75,180 A15,15 0 0,1 60,195 A15,15 0 0,1 45,180 M225,90 A15,15 0 0,0 210,75 A15,15 0 0,0 195,90 L195,135 L195,180 A15,15 0 0,0 210,195 L210,195 A15,15 0 0,0 225,180 M135,105 A30,30 0 0,1 165,135 A30,30 0 0,1 135,165 A30,30 0 0,1 105,135 A30,30 0 0,1 135,105 M45,105 L45,105 L45,165 M225,105 L225,105 L225,165 ">
          </path>
        </svg>
      </a>
    </div>

    <div class="nav-segments-container">
      <div class="nav-segments">
        

        <div class="flex flex-col text-left nav-links">
          <a href="/projects" class="activated-link">Projects</a>
          
          
          <a href="/archive">Archive</a>
          
          
          
          <a href="/meta">Meta</a>
          
          
          
          <a href="/notes">Notes</a>
          
          
          
          <a href="/posts">Posts</a>
          
          
          
          
          
        </div>
        

        

        <div class="flex flex-col text-left nav-links">
          <a href="/alculator" class="activated-link">Alculator</a>
          
          
          
          
          
          <a href="/covid-19-tracker">COVID-19 Tracker</a>
          
          
          
          <a href="/mastodon-thread-unroller">Mastodon Thread Unroller</a>
          
          
          
          <a href="/minecraftle">Minecraftle</a>
          
          
          
          <a href="/ochrs">Ochrs</a>
          
          
          
          <a href="/penultimate-guitar">Penultimate Guitar</a>
          
          
          
          <a href="/status-messenger">Status Messenger</a>
          
          
          
          <a href="/ironprof">ironprof</a>
          
          
          
          <a href="/snakeware">snakeware</a>
          
          
        </div>
        

        
      </div>
    </div>


  </nav>
  <main>
    <header>
      <h1>An alternate frontend for Dan Murphy's.</h1>
    </header>
    <article><p><a href="https://alculator.zachmanson.com">Alculator</a> was written in the waning days of 2022 to determine the cheapest drinks at Dan Murphy's, per standard drink. The site is build with Next.js and hosted on Vercel.</p>
<p>If you click on the title bar there is a hidden interface used for debugging and finding data anomalies.</p>
<h2 id="dans-api">Dan's API</h2>
<p>Dan Murphy's website is a bloated Angular project but the public APIs used by the site have little to no security. After some mild poking around I was able to determine the routes needed and the general schema in use. Annoyingly, their APIs seemed designed around serving data that the frontend could display with almost no modification, rather than serving data in a logical format.</p>
<p>For example, for any given product, the site will send a JSON object.  This will contain 3 different prices for the product for the different pack sizes you can purchase them in.  These are labelled <code>caseprice</code>, <code>singleprice</code>, and <code>inanysixprice</code>. Case price, understably, represents the price of a case.  A case of Gage Roads Pipe Dreams Coastal Lager Bottles may have a caseprice of $31.55, but the only way to know how many bottles are in this case are in a field called <code>caseprice.Message</code>.  This is actually a string, that <em>usually</em> says something like "case (24)", when it should obviously just be an associated int called something like <code>caseprice.units</code>.</p>
<p><code>singleprice</code> and <code>inanysixprice</code> are even worse, as they are used semi-interchangably. <code>singleprice</code> tends to represent the price of a single bottle, and <code>inanysixprice</code> tends to represent the price of a single bottle in a pack of 6.  Althought sometimes it's a pack of 4.  Or 8.  When <code>singleprice</code> isn't undefined, <code>singleprice</code> sometimes refers to the price of a pack of 6.  The only way to know for sure is by checking if <code>singleprice?.PackType === "Pack"</code> or <code>singleprice?.PackType === "Bottle"</code>.  And of course, when <code>singleprice</code> does mean a pack, the number of units is <em>usually</em> stored in a string.</p>
<p>This is all in service of avoiding frontend rendering logic as much as possible.  Perhaps this is why their API server is so horrendously slow. It can take minutes to return a list of 500 drinks, and times out easily.  To get all of their products (1000+ beers, 6000+ red wines) in my script I needed to sequentially chain queries in batches of 100 drinks.</p>
<p>The data itself is riddled with mistakes an inconsistencies. "Standard Drinks" is inconsistently used in packs, where usually it represents a single unit and <a href="https://www.danmurphys.com.au/product/808932">occasionally it represents the sum of all the units</a>.  Sometimes fields are just completely wrong (<a href="https://www.danmurphys.com.au/product/194571">White Bay Brewing Alcohol Volume especially bad</a>), or use values for bottles of different sizes (<a href="https://www.danmurphys.com.au/product/907223">350mL bottle with 11 standards</a>). These products are collected in the <a href="https://github.com/pavo-etc/alculator/blob/main/science/blacklist.json"><code>blacklist.json</code></a> file and ignored by the script that downloads the catalogue.</p>
<p><a href="https://github.com/pavo-etc/alculator/blob/main/science/api.js">The final script</a> is warty and takes about 15 minutes to run, but converts the data to a sane schema.  This script is run daily via GitHub Action, and the new data is directly stored in JSON files and committed to the repo.  This is inefficient, but meant I didn't have to mess around with databases in my deployment.  I do hope to one day set up a proper database for this.</p>
<p>The source code is available on <a href="https://github.com/pavo-etc/alculator">GitHub</a>.</p></article>

    <hr />

    <div class="meta">
      

      
      <p class="backlinks"><span class="bold">Incoming:</span>
        
        <a href="/dns">DNS</a>
        
        <a href="/github-repo-metadata">GitHub Repo Metadata</a>
        
        <a href="/penultimate-guitar">Penultimate Guitar</a>
        
        <a href="/spite-driven-development">Spite Driven Development</a>
        
        </span>
      </p>
      

      
      <p class="backlinks"><span class="bold">Tags:</span>
        
        <a href="/tags#nextjs">#nextjs</a>
        
        <a href="/tags#prisma">#prisma</a>
        
        <a href="/tags#postgres">#postgres</a>
        
        <a href="/tags#react">#react</a>
        
        <a href="/tags#venting">#venting</a>
        
        </span>
      </p>
      
    </div>
  </main>
  <footer>
    <a href="mailto:zachpmanson@gmail.com?subject=On 'Alculator'">reply</a>
    <a href="/pytorch">random</a>
    <a href="/recent-changes">updates</a>
    <a href="/tags">tags</a>
    <a href="/sitemap">sitemap</a>
    <a href="https://github.dev/pavo-etc/notes/blob/main/./notes/Projects/Alculator.md">edit</a>
  </footer>
  
</body>

</html>