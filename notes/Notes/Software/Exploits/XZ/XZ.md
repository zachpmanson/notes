---
subtitle: The most advanced supply chain attack ever found.
---
The XZ exploit is a clever supply chain attack, placing a RCE in sshd using a vulnerability in XZ, a compression library that many [[Linux]] distributions call when running OpenSSH (sshd -> libsystemd (for logging) -> liblzma).  It was discovered by Andres Freund when he noticed that sshd was running with abnormally high CPU usage.

The vulnerability was submitted by Jia Tan, one of two maintainers of XZ.   The vulnerability was extremely obfuscated.  [Read the original backdoor report by Andres Freund for more details on this](https://www.openwall.com/lists/oss-security/2024/03/29/4).

## Maintainers

There are two maintainers of the XZ projects, Jia Tan and Lasse Collin.  Lasse Collin is the original author of the XZ Utils library, whereas Jia Tan has only been a maintainer since 2022.

Tan appears so have little to no online footprint prior to 2021 when they started making useful contributions to XZ.  It is speculated that Jia Tan is an invented persona.

> He has been part of the xz project for 2 years, adding all sorts of binary test files, and to be honest with this level of sophistication I would be suspicious of even older versions of xz until proven otherwise.

-- [Richard Jones](https://news.ycombinator.com/item?id=39866275)

- [A Microcosm of the interactions in Open Source projects](https://robmensching.com/blog/posts/2024/03/30/a-microcosm-of-the-interactions-in-open-source-projects/), and interesting analysis of mailing list discussions about Jia Tan's contributions to the XZ project before Tan was made maintainer
- [Lasse Collin's page](https://tukaani.org/xz-backdoor/) tracking the vulnerability

## Oddities

- In 2022 [there were other suspected sock puppet accounts pushing Collin to introduce new maintainers](https://www.mail-archive.com/xz-devel@tukaani.org/msg00566.html)
- Tan disabled a function in [oss-fuzzer](https://github.com/google/oss-fuzz/pull/10667) in 2023 that the exploit relied on that may have revealed the exploit ([source](https://social.treehouse.systems/@Aissen/112180302735030319))
- the day before the exploit was found the xz-java project added a SECURITY.md file 

> If you discover a security vulnerability in this project please report it privately. *Do not disclose it as a public issue.* This gives us time to work with you to fix the issue before public exposure, reducing the chance that the exploit will be used before a patch is released.

- It disabled Linux landlock?
	- [This commit](https://git.tukaani.org/?p=xz.git;a=blobdiff;f=CMakeLists.txt;h=d2b1af7ab0ab759b6805ced3dff2555e2a4b3f8e;hp=76700591059711e3a4da5b45cf58474dac4e12a7;hb=328c52da8a2bbb81307644efdb58db2c422d9ba7;hpb=eb8ad59e9bab32a8d655796afd39597ea6dcc64d) introduces a syntax error that prevents Linux landlock from being activated.  The test program designed to test if landlock was supported would always fail due to this errant `.`.

## Discovery

> I was doing some micro-benchmarking at the time, needed to quiesce the system to reduce noise. Saw sshd processes were using a surprising amount of CPU, despite immediately failing because of wrong usernames etc. Profiled sshd, showing lots of cpu time in liblzma, with perf unable to attribute it to a symbol. Got suspicious. Recalled that I had seen an odd valgrind complaint in automated testing of postgres, a few weeks earlier, after package updates.
> 
> Really required a lot of coincidences.

-- [Andres Freund (a Postgres developer at Microsoft)](https://mastodon.social/@AndresFreundTec/112180083704606941)

## Links

- [FAQ on the exploit](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27) by Sam James
- [Initial discussion on hn](https://news.ycombinator.com/item?id=39865810)
- [CVE Report](https://www.cve.org/CVERecord?id=CVE-2024-3094)
- [Original backdoor report by Freund](https://www.openwall.com/lists/oss-security/2024/03/29/4)
- [Discovery of RCE](https://bsky.app/profile/did:plc:x2nsupeeo52oznrmplwapppl/post/3kowjkx2njy2b)
- [Technologist vs Spy](https://lcamtuf.substack.com/p/technologist-vs-spy-the-xz-backdoor), making the case that based on the behaviour and circumstances surrounding the bug were that of organised actors
- [XZ Backdoor Documentation](https://github.com/Midar/xz-backdoor-documentation/wiki)
 